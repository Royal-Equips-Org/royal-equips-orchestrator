<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Royal Equips Control Center</title>
    <style>
        :root {
            --deep-space: #0A0A0F;
            --panel-dark: #1A1A2E;
            --electric-blue: #00FFFF;
            --neon-orange: #FF6600;
            --matrix-green: #00FF41;
            --warning-red: #FF0040;
            --purple-glow: #8A2BE2;
            --white-core: #FFFFFF;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: var(--deep-space);
            color: var(--electric-blue);
            font-family: 'Courier New', monospace;
            overflow-x: hidden;
            min-height: 100vh;
        }

        .glow {
            text-shadow: 0 0 10px currentColor;
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 0.6; }
            50% { opacity: 1; }
            100% { opacity: 0.6; }
        }

        .header {
            padding: 20px;
            border-bottom: 1px solid var(--electric-blue);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .status-badges {
            display: flex;
            gap: 10px;
        }

        .badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            border: 1px solid;
        }

        .badge.online { border-color: var(--matrix-green); color: var(--matrix-green); }
        .badge.offline { border-color: var(--warning-red); color: var(--warning-red); }
        .badge.god-mode { background: var(--purple-glow); color: white; }
        .badge.emergency { background: var(--warning-red); color: white; }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 300px 1fr;
            gap: 20px;
            padding: 20px;
            height: calc(100vh - 120px);
        }

        .holographic-hub {
            grid-column: span 2;
            background: var(--panel-dark);
            border: 1px solid var(--electric-blue);
            border-radius: 8px;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        .hub-canvas {
            width: 100%;
            height: 100%;
            border: 1px solid var(--electric-blue);
            border-radius: 4px;
        }

        .metrics-panel, .agents-panel, .control-panel {
            background: var(--panel-dark);
            border: 1px solid var(--electric-blue);
            border-radius: 8px;
            padding: 20px;
            overflow-y: auto;
        }

        .control-panel {
            border-color: var(--neon-orange);
        }

        .agents-panel {
            border-color: var(--matrix-green);
        }

        .panel-title {
            font-size: 18px;
            margin-bottom: 15px;
            border-bottom: 1px solid currentColor;
            padding-bottom: 5px;
        }

        .metric-item {
            margin-bottom: 15px;
        }

        .metric-label {
            font-size: 12px;
            color: var(--electric-blue);
            margin-bottom: 5px;
        }

        .metric-bar {
            width: 100%;
            height: 8px;
            background: var(--deep-space);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 5px;
        }

        .metric-fill {
            height: 100%;
            transition: width 0.3s ease;
        }

        .metric-value {
            font-size: 11px;
            opacity: 0.8;
        }

        .control-button {
            width: 100%;
            padding: 12px;
            margin-bottom: 10px;
            background: transparent;
            border: 1px solid var(--electric-blue);
            color: var(--electric-blue);
            font-family: inherit;
            font-size: 14px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .control-button:hover {
            background: var(--electric-blue);
            color: var(--deep-space);
        }

        .control-button.active {
            background: var(--purple-glow);
            border-color: var(--purple-glow);
            color: white;
        }

        .control-button.emergency {
            border-color: var(--warning-red);
            color: var(--warning-red);
        }

        .control-button.emergency:hover {
            background: var(--warning-red);
            color: white;
        }

        .agent-item {
            margin-bottom: 15px;
            padding: 10px;
            background: var(--deep-space);
            border-radius: 4px;
            border: 1px solid transparent;
        }

        .agent-item.active { border-color: var(--matrix-green); }
        .agent-item.processing { border-color: var(--neon-orange); }
        .agent-item.idle { border-color: #666; }

        .agent-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .agent-stats {
            font-size: 11px;
            opacity: 0.8;
            display: flex;
            justify-content: space-between;
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 4px;
            color: white;
            font-size: 14px;
            z-index: 1000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.success { background: var(--matrix-green); }
        .toast.error { background: var(--warning-red); }
        .toast.warning { background: var(--neon-orange); }
    </style>
</head>
<body>
    <div class="header">
        <div>
            <h1 class="glow">üöÄ ROYAL EQUIPS CONTROL CENTER</h1>
            <div class="status-badges">
                <div class="badge" id="connection-status">OFFLINE</div>
                <div class="badge god-mode pulse" id="god-mode-badge" style="display: none;">GOD MODE</div>
                <div class="badge emergency pulse" id="emergency-badge" style="display: none;">üö® EMERGENCY</div>
            </div>
        </div>
        <div>
            <div id="timestamp">--:--:--</div>
            <div style="font-size: 12px; opacity: 0.6;">v2.0.0</div>
        </div>
    </div>

    <div class="main-grid">
        <div class="holographic-hub">
            <div class="panel-title glow">üåê Central Holographic Hub</div>
            <canvas id="hub-canvas" class="hub-canvas"></canvas>
        </div>

        <div class="metrics-panel">
            <div class="panel-title glow">üìä System Metrics</div>
            <div id="metrics-content">
                <div class="metric-item">
                    <div class="metric-label">CPU Usage</div>
                    <div class="metric-bar">
                        <div class="metric-fill" id="cpu-fill" style="background: var(--matrix-green); width: 0%;"></div>
                    </div>
                    <div class="metric-value" id="cpu-value">0%</div>
                </div>
                <div class="metric-item">
                    <div class="metric-label">Memory Usage</div>
                    <div class="metric-bar">
                        <div class="metric-fill" id="memory-fill" style="background: var(--matrix-green); width: 0%;"></div>
                    </div>
                    <div class="metric-value" id="memory-value">0%</div>
                </div>
                <div class="metric-item">
                    <div class="metric-label">Disk Usage</div>
                    <div class="metric-bar">
                        <div class="metric-fill" id="disk-fill" style="background: var(--matrix-green); width: 0%;"></div>
                    </div>
                    <div class="metric-value" id="disk-value">0%</div>
                </div>
                <div class="metric-item">
                    <div class="metric-label">Uptime</div>
                    <div class="metric-value" id="uptime-value">0h 0m</div>
                </div>
            </div>
        </div>

        <div class="agents-panel">
            <div class="panel-title glow" style="color: var(--matrix-green);">ü§ñ Agent Status</div>
            <div id="agents-content">
                <div style="opacity: 0.6;">Loading agents...</div>
            </div>
        </div>

        <div class="control-panel">
            <div class="panel-title glow" style="color: var(--neon-orange);">üéõÔ∏è Control Systems</div>
            <button class="control-button" id="god-mode-btn" onclick="toggleGodMode()">
                ‚ö° ACTIVATE GOD MODE
            </button>
            <button class="control-button emergency" id="emergency-btn" onclick="triggerEmergency()">
                üö® EMERGENCY STOP
            </button>
            <div style="font-size: 11px; opacity: 0.6; text-align: center; margin-top: 10px;">
                Use responsibly. All actions are logged.
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.5/socket.io.js"></script>
    <script>
        // Global state
        let socket;
        let isConnected = false;
        let godMode = false;
        let emergencyStop = false;

        // Initialize SocketIO connection
        function initSocket() {
            socket = io();

            socket.on('connect', () => {
                console.log('Connected to Control Center');
                isConnected = true;
                updateConnectionStatus();
            });

            socket.on('disconnect', () => {
                console.log('Disconnected from Control Center');
                isConnected = false;
                updateConnectionStatus();
            });

            socket.on('heartbeat', (data) => {
                updateTimestamp(data.timestamp);
            });

            socket.on('metrics_update', (data) => {
                updateMetrics(data);
            });

            socket.on('agent_status', (data) => {
                updateAgents(data);
            });

            socket.on('control_event', (event) => {
                handleControlEvent(event);
            });
        }

        function updateConnectionStatus() {
            const badge = document.getElementById('connection-status');
            badge.textContent = isConnected ? 'ONLINE' : 'OFFLINE';
            badge.className = `badge ${isConnected ? 'online' : 'offline'}`;
        }

        function updateTimestamp(timestamp) {
            const elem = document.getElementById('timestamp');
            elem.textContent = new Date(timestamp).toLocaleTimeString();
        }

        function updateMetrics(metrics) {
            // Update CPU
            const cpuFill = document.getElementById('cpu-fill');
            const cpuValue = document.getElementById('cpu-value');
            cpuFill.style.width = metrics.cpu_percent + '%';
            cpuFill.style.background = metrics.cpu_percent > 80 ? 'var(--warning-red)' : 'var(--matrix-green)';
            cpuValue.textContent = metrics.cpu_percent.toFixed(1) + '%';

            // Update Memory
            const memFill = document.getElementById('memory-fill');
            const memValue = document.getElementById('memory-value');
            memFill.style.width = metrics.memory_percent + '%';
            memFill.style.background = metrics.memory_percent > 85 ? 'var(--warning-red)' : 'var(--matrix-green)';
            memValue.textContent = `${metrics.memory_used_gb.toFixed(1)}GB / ${metrics.memory_total_gb.toFixed(1)}GB`;

            // Update Disk
            const diskFill = document.getElementById('disk-fill');
            const diskValue = document.getElementById('disk-value');
            diskFill.style.width = metrics.disk_percent + '%';
            diskFill.style.background = metrics.disk_percent > 90 ? 'var(--warning-red)' : 'var(--matrix-green)';
            diskValue.textContent = metrics.disk_percent.toFixed(1) + '%';

            // Update Uptime
            const uptimeValue = document.getElementById('uptime-value');
            const hours = Math.floor(metrics.uptime_seconds / 3600);
            const minutes = Math.floor((metrics.uptime_seconds % 3600) / 60);
            uptimeValue.textContent = `${hours}h ${minutes}m`;
        }

        function updateAgents(agentData) {
            const container = document.getElementById('agents-content');
            
            if (!agentData.agents || agentData.agents.length === 0) {
                container.innerHTML = '<div style="opacity: 0.6;">No agents detected...</div>';
                return;
            }

            let html = '';
            agentData.agents.forEach(agent => {
                const statusIcon = agent.status === 'active' ? 'üü¢' : 
                                 agent.status === 'processing' ? 'üü°' : '‚ö´';
                
                html += `
                    <div class="agent-item ${agent.status}">
                        <div class="agent-name">${statusIcon} ${agent.name}</div>
                        <div class="agent-stats">
                            <span>CPU: ${agent.cpu_percent.toFixed(1)}%</span>
                            <span>RAM: ${agent.memory_mb.toFixed(0)}MB</span>
                        </div>
                        <div class="agent-stats">
                            <span>Tasks: ${agent.tasks_completed}</span>
                            <span>Success: ${(agent.success_rate * 100).toFixed(1)}%</span>
                        </div>
                    </div>
                `;
            });

            // Add summary
            html += `
                <div style="margin-top: 15px; padding: 10px; background: var(--deep-space); border-radius: 4px;">
                    <div style="color: var(--matrix-green); font-weight: bold; margin-bottom: 5px;">üìä Fleet Summary</div>
                    <div style="font-size: 11px;">
                        <div>Total: ${agentData.agents.length} | Active: ${agentData.total_active}</div>
                        <div>Avg CPU: ${agentData.average_cpu.toFixed(1)}%</div>
                    </div>
                </div>
            `;

            container.innerHTML = html;
        }

        function handleControlEvent(event) {
            console.log('Control event:', event);
            
            if (event.event_type === 'god_mode') {
                godMode = event.data.enabled;
                updateGodModeUI();
                showToast(event.data.message, godMode ? 'warning' : 'success');
            } else if (event.event_type === 'emergency_stop') {
                emergencyStop = true;
                updateEmergencyUI();
                showToast('üö® EMERGENCY STOP ACTIVATED', 'error');
            } else if (event.event_type === 'emergency_reset') {
                emergencyStop = false;
                updateEmergencyUI();
                showToast('Emergency Reset Complete', 'success');
            }
        }

        function updateGodModeUI() {
            const badge = document.getElementById('god-mode-badge');
            const button = document.getElementById('god-mode-btn');
            
            badge.style.display = godMode ? 'block' : 'none';
            button.textContent = godMode ? 'üîÆ GOD MODE ON' : '‚ö° ACTIVATE GOD MODE';
            button.className = godMode ? 'control-button active' : 'control-button';
        }

        function updateEmergencyUI() {
            const badge = document.getElementById('emergency-badge');
            const button = document.getElementById('emergency-btn');
            
            badge.style.display = emergencyStop ? 'block' : 'none';
            button.textContent = emergencyStop ? 'üîÑ RESET EMERGENCY' : 'üö® EMERGENCY STOP';
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type} show`;
            
            setTimeout(() => {
                toast.className = `toast ${type}`;
            }, 3000);
        }

        async function toggleGodMode() {
            try {
                const response = await fetch('/api/control/god-mode', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ enabled: !godMode })
                });

                if (!response.ok) {
                    throw new Error('Failed to toggle God Mode');
                }
            } catch (error) {
                showToast('God Mode Toggle Failed', 'error');
            }
        }

        async function triggerEmergency() {
            if (emergencyStop) {
                // Reset emergency
                if (!confirm('Are you sure you want to reset the emergency stop?')) return;
                
                try {
                    const response = await fetch('/api/control/reset-emergency', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ confirm: true, reason: 'Manual reset from Control Center' })
                    });

                    if (!response.ok) {
                        throw new Error('Failed to reset emergency stop');
                    }
                } catch (error) {
                    showToast('Emergency Reset Failed', 'error');
                }
            } else {
                // Trigger emergency
                if (!confirm('üö® EMERGENCY STOP - This will halt all operations. Continue?')) return;
                
                try {
                    const response = await fetch('/api/control/emergency-stop', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ reason: 'Manual emergency stop from Control Center' })
                    });

                    if (!response.ok) {
                        throw new Error('Failed to trigger emergency stop');
                    }
                } catch (error) {
                    showToast('Emergency Stop Failed', 'error');
                }
            }
        }

        // Holographic Hub Canvas Animation
        function initHubCanvas() {
            const canvas = document.getElementById('hub-canvas');
            const ctx = canvas.getContext('2d');
            
            function resizeCanvas() {
                canvas.width = canvas.offsetWidth;
                canvas.height = canvas.offsetHeight;
            }

            function animate() {
                resizeCanvas();
                
                // Clear canvas
                ctx.fillStyle = '#0A0A0F';
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                const centerX = canvas.width / 2;
                const centerY = canvas.height / 2;
                const time = Date.now() * 0.001;

                // Central core
                ctx.beginPath();
                ctx.arc(centerX, centerY, 20, 0, Math.PI * 2);
                ctx.fillStyle = isConnected ? '#00FF41' : '#FF0040';
                ctx.fill();

                // Pulsing rings
                for (let i = 1; i <= 3; i++) {
                    const radius = 20 + i * 15 + Math.sin(time * 2 + i) * 5;
                    ctx.beginPath();
                    ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
                    ctx.strokeStyle = '#00FFFF';
                    ctx.lineWidth = 1;
                    ctx.globalAlpha = 0.5 - (i * 0.1);
                    ctx.stroke();
                }

                ctx.globalAlpha = 1;

                // Grid
                ctx.strokeStyle = '#1A1A2E';
                ctx.lineWidth = 1;
                for (let x = 0; x < canvas.width; x += 40) {
                    ctx.beginPath();
                    ctx.moveTo(x, 0);
                    ctx.lineTo(x, canvas.height);
                    ctx.stroke();
                }
                for (let y = 0; y < canvas.height; y += 40) {
                    ctx.beginPath();
                    ctx.moveTo(0, y);
                    ctx.lineTo(canvas.width, y);
                    ctx.stroke();
                }

                requestAnimationFrame(animate);
            }

            animate();
        }

        // Initialize everything
        document.addEventListener('DOMContentLoaded', () => {
            initSocket();
            initHubCanvas();
            updateConnectionStatus();
        });
    </script>
</body>
</html>
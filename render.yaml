# Render configuration for deploying Royal Equips Orchestrator
services:
  # FastAPI API
  - type: web
    name: orchestrator-api
    env: docker
    plan: free
    dockerfilePath: ./Dockerfile
    healthCheckPath: /health
    envVars:
      - key: SHOPIFY_API_KEY
        sync: false
      - key: SHOPIFY_API_SECRET
        sync: false
      - key: SHOP_NAME
        sync: false
      - key: OPENAI_API_KEY
        sync: false
      - key: BIGQUERY_PROJECT_ID
        sync: false
      - key: BIGQUERY_DATASET
        sync: false
      - key: BIGQUERY_TABLE
        sync: false
      - key: GITHUB_TOKEN
        sync: false

  # FastAPI command center (lightweight runtime)
  - type: web
    name: command-center
    runtime: python
    plan: free
    buildCommand: pip install -r requirements-minimal.txt
    startCommand: ./start.sh
    envVars:
      - key: PYTHON_VERSION
        value: 3.11.9
      - key: APP_TYPE
        value: fastapi
      - key: APP_PATH
        value: api.main:app
      - key: SHOPIFY_API_KEY
        sync: false
      - key: SHOPIFY_API_SECRET
        sync: false
      - key: SHOP_NAME
        sync: false
      - key: OPENAI_API_KEY
        sync: false
      - key: BIGQUERY_PROJECT_ID
        sync: false
      - key: BIGQUERY_DATASET
        sync: false
      - key: BIGQUERY_TABLE
        sync: false
      - key: GITHUB_TOKEN
        sync: false
      # Configuration for command center
      - key: COMMAND_CENTER_URL
        value: /docs

  # Daily analytics export at 03:00 UTC
  - type: cron
    name: export-analytics
    env: docker
    dockerfilePath: ./Dockerfile
    schedule: "0 3 * * *"
    dockerCommand: >
      python scripts/run_analytics.py
    envVars:
      - key: SHOPIFY_API_KEY
        sync: false
      - key: SHOPIFY_API_SECRET
        sync: false
      - key: SHOP_NAME
        sync: false
      - key: OPENAI_API_KEY
        sync: false
      - key: BIGQUERY_PROJECT_ID
        sync: false
      - key: BIGQUERY_DATASET
        sync: false
      - key: BIGQUERY_TABLE
        sync: false

  # Daily security scan at 02:00 UTC
  - type: cron
    name: security-scan
    env: docker
    dockerfilePath: ./Dockerfile
    schedule: "0 2 * * *"
    dockerCommand: >
      python scripts/run_security_checks.py
    envVars:
      - key: SHOPIFY_API_KEY
        sync: false
      - key: SHOPIFY_API_SECRET
        sync: false
      - key: SHOP_NAME
        sync: false
      - key: OPENAI_API_KEY
        sync: false
      - key: BIGQUERY_PROJECT_ID
        sync: false
      - key: BIGQUERY_DATASET
        sync: false
      - key: BIGQUERY_TABLE
        sync: false

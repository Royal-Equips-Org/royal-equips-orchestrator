import{f as I,x as U,r as o,j as e,R as E,T as F,D as H,s as V,b as q,c as W,S as v,E as Z,G as Q,Z as z,o as B}from"./index-DGVu5RhP.js";import{s as J}from"./middleware-C1IJlFYS.js";import{l as K}from"./index-TjCxX7sJ.js";import{u as O}from"./usePerformance-D9WqG5wi.js";import{a as w,A as _}from"./arrow-up-BmP9dCgx.js";/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=I("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),Y=U()(J((a,m)=>({socket:null,isConnected:!1,error:null,reconnectAttempts:0,messages:[],connect:(l="http://localhost:10000")=>{const{socket:h}=m();if(h){console.warn("Socket already connected");return}try{const n=K(l,{transports:["websocket","polling"],timeout:2e4,reconnection:!0,reconnectionAttempts:5,reconnectionDelay:1e3});n.on("connect",()=>{a({isConnected:!0,error:null,reconnectAttempts:0}),console.log("Socket connected successfully")}),n.on("disconnect",i=>{a({isConnected:!1}),console.log("Socket disconnected:",i)}),n.on("connect_error",i=>{a(x=>({error:i.message,reconnectAttempts:x.reconnectAttempts+1})),console.error("Socket connection error:",i)}),n.onAny((i,x)=>{a(p=>({messages:[...p.messages.slice(-99),{id:`${Date.now()}-${Math.random()}`,type:i,data:x,timestamp:Date.now()}]}))}),a({socket:n})}catch(n){a({error:n instanceof Error?n.message:"Failed to connect to socket"})}},disconnect:()=>{const{socket:l}=m();l&&(l.disconnect(),a({socket:null,isConnected:!1,error:null,reconnectAttempts:0}))},sendMessage:(l,h)=>{const{socket:n,isConnected:i}=m();if(!n||!i){console.warn("Cannot send message: Socket not connected");return}try{n.emit(l,h)}catch(x){a({error:x instanceof Error?x.message:"Failed to send message"})}},clearMessages:()=>{a({messages:[]})},clearError:()=>{a({error:null})}}))),ne=()=>{const[a,m]=o.useState(null),[l,h]=o.useState([]),[n,i]=o.useState(!0),[x,p]=o.useState(null),[k,S]=o.useState(!1),[$,P]=o.useState("daily"),[j,T]=o.useState("dashboard"),D=Y(),{trackPerformance:u,trackInteraction:L}=O(),f=async()=>{try{S(!0);const s=await fetch("/api/finance/dashboard");if(!s.ok)throw new Error("Failed to fetch dashboard data");const t=await s.json();if(t.status==="success")m(t.data),p(null);else throw new Error(t.error||"Unknown error")}catch(s){console.error("Finance dashboard error:",s),p(s instanceof Error?s.message:"Failed to load finance data")}finally{i(!1),S(!1)}},G=async(s={})=>{try{const t=new URLSearchParams(s),c=await fetch(`/api/finance/transactions?${t}`);if(!c.ok)throw new Error("Failed to fetch transactions");const C=await c.json();C.status==="success"&&h(C.data.transactions)}catch(t){console.error("Transaction fetch error:",t)}};o.useEffect(()=>{f(),G();const s=setInterval(f,3e4);return()=>clearInterval(s)},[]),o.useEffect(()=>{const s=D.socket;if(s)return s.on("finance_update",t=>{m(c=>c?{...c,...t}:t),u("finance_realtime_update")}),s.on("transaction_processed",t=>{h(c=>[t,...c.slice(0,49)]),u("finance_transaction_update")}),s.on("fraud_alert",t=>{a&&m(c=>c&&{...c,fraud_alerts:[t,...c.fraud_alerts]}),u("finance_fraud_alert")}),()=>{s.off("finance_update"),s.off("transaction_processed"),s.off("fraud_alert")}},[D.socket,a,u]);const r=o.useMemo(()=>{if(!a)return null;const{financial_metrics:s,overview:t}=a;return{revenueGrowth:s.profit_margin>0?15.8:-5.2,conversionTrend:s.conversion_rate>2.5?"up":"down",fraudRate:t.fraud_alerts/(t.fraud_alerts+l.length)*100||0,avgProcessingTime:2.3,topPaymentMethod:"Credit Card",cashFlowHealth:s.net_profit>0?"healthy":"warning"}},[a,l]),g=(s,t="USD")=>new Intl.NumberFormat("en-US",{style:"currency",currency:t}).format(s),y=s=>`${s.toFixed(1)}%`,R=s=>{switch(s.toLowerCase()){case"captured":case"completed":return"text-green-400";case"pending":return"text-yellow-400";case"failed":case"declined":return"text-red-400";default:return"text-gray-400"}},N=s=>s>=70?"text-red-400":s>=55?"text-yellow-400":"text-green-400";if(n)return e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(E,{className:"h-6 w-6 animate-spin text-cyan-400"}),e.jsx("span",{className:"text-lg",children:"Loading financial data..."})]})});if(x)return e.jsxs("div",{className:"bg-red-900/20 border border-red-500/20 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx(F,{className:"h-6 w-6 text-red-400"}),e.jsx("h3",{className:"text-lg font-semibold text-red-400",children:"Finance Module Error"})]}),e.jsx("p",{className:"text-red-300 mb-4",children:x}),e.jsx("button",{onClick:f,className:"px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg transition-colors",children:"Retry"})]});if(!a)return null;const{overview:b,financial_metrics:d,recent_activity:M,fraud_alerts:A}=a;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-green-500/20 rounded-lg",children:e.jsx(H,{className:"h-6 w-6 text-green-400"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Financial Intelligence"}),e.jsx("p",{className:"text-gray-400",children:"Real-time financial operations & analytics"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("select",{value:$,onChange:s=>{P(s.target.value),L("finance_period_change")},className:"bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-sm",children:[e.jsx("option",{value:"daily",children:"Today"}),e.jsx("option",{value:"weekly",children:"This Week"}),e.jsx("option",{value:"monthly",children:"This Month"}),e.jsx("option",{value:"quarterly",children:"This Quarter"})]}),e.jsxs("select",{value:j,onChange:s=>T(s.target.value),className:"bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-sm",children:[e.jsx("option",{value:"dashboard",children:"Dashboard"}),e.jsx("option",{value:"transactions",children:"Transactions"}),e.jsx("option",{value:"analytics",children:"Analytics"}),e.jsx("option",{value:"fraud",children:"Fraud Detection"})]}),e.jsxs("button",{onClick:f,disabled:k,className:"flex items-center space-x-2 px-3 py-2 bg-cyan-600 hover:bg-cyan-700 disabled:opacity-50 rounded-lg transition-colors",children:[e.jsx(E,{className:`h-4 w-4 ${k?"animate-spin":""}`}),e.jsx("span",{children:"Refresh"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Revenue Today"}),e.jsx("p",{className:"text-2xl font-bold text-green-400",children:g(b.total_revenue_today)})]}),e.jsx("div",{className:"p-3 bg-green-500/20 rounded-lg",children:e.jsx(V,{className:"h-6 w-6 text-green-400"})})]}),r&&e.jsxs("div",{className:"flex items-center mt-2 text-sm",children:[r.revenueGrowth>0?e.jsx(w,{className:"h-4 w-4 text-green-400 mr-1"}):e.jsx(_,{className:"h-4 w-4 text-red-400 mr-1"}),e.jsx("span",{className:r.revenueGrowth>0?"text-green-400":"text-red-400",children:y(Math.abs(r.revenueGrowth))}),e.jsx("span",{className:"text-gray-400 ml-1",children:"vs yesterday"})]})]}),e.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Transactions"}),e.jsx("p",{className:"text-2xl font-bold text-cyan-400",children:d.transaction_count.toLocaleString()})]}),e.jsx("div",{className:"p-3 bg-cyan-500/20 rounded-lg",children:e.jsx(q,{className:"h-6 w-6 text-cyan-400"})})]}),e.jsxs("div",{className:"flex items-center mt-2 text-sm",children:[e.jsx("span",{className:"text-gray-400",children:"Avg: "}),e.jsx("span",{className:"text-cyan-400 ml-1",children:g(d.avg_transaction_value)})]})]}),e.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Conversion Rate"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-400",children:y(d.conversion_rate)})]}),e.jsx("div",{className:"p-3 bg-yellow-500/20 rounded-lg",children:e.jsx(W,{className:"h-6 w-6 text-yellow-400"})})]}),e.jsxs("div",{className:"flex items-center mt-2 text-sm",children:[(r==null?void 0:r.conversionTrend)==="up"?e.jsx(w,{className:"h-4 w-4 text-green-400 mr-1"}):e.jsx(_,{className:"h-4 w-4 text-red-400 mr-1"}),e.jsx("span",{className:"text-gray-400",children:"trend"})]})]}),e.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Fraud Alerts"}),e.jsx("p",{className:"text-2xl font-bold text-red-400",children:b.fraud_alerts})]}),e.jsx("div",{className:"p-3 bg-red-500/20 rounded-lg",children:e.jsx(v,{className:"h-6 w-6 text-red-400"})})]}),e.jsxs("div",{className:"flex items-center mt-2 text-sm",children:[e.jsx("span",{className:"text-gray-400",children:"Risk: "}),e.jsx("span",{className:N((r==null?void 0:r.fraudRate)||0),children:y((r==null?void 0:r.fraudRate)||0)})]})]})]}),j==="dashboard"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Recent Transactions"}),e.jsxs("button",{onClick:()=>T("transactions"),className:"text-cyan-400 hover:text-cyan-300 text-sm flex items-center space-x-1",children:[e.jsx(Z,{className:"h-4 w-4"}),e.jsx("span",{children:"View All"})]})]}),e.jsx("div",{className:"space-y-3",children:M.slice(0,6).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-700/30 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${s.type==="revenue"?"bg-green-500/20":s.type==="expense"?"bg-red-500/20":"bg-gray-500/20"}`,children:s.type==="revenue"?e.jsx(w,{className:"h-4 w-4 text-green-400"}):e.jsx(_,{className:"h-4 w-4 text-red-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:g(s.amount,s.currency)}),e.jsxs("p",{className:"text-sm text-gray-400",children:[s.payment_method," â€¢ ",s.gateway]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${R(s.status)}`,children:s.status}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:new Date(s.processed_at).toLocaleTimeString()})]})]},s.id))})]}),e.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Financial Health"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Profit Margin"}),e.jsx("span",{className:"text-sm font-medium",children:y(d.profit_margin)})]}),e.jsx("div",{className:"h-2 bg-gray-700 rounded-full",children:e.jsx("div",{className:`h-2 rounded-full ${d.profit_margin>20?"bg-green-500":d.profit_margin>10?"bg-yellow-500":"bg-red-500"}`,style:{width:`${Math.max(5,Math.min(100,d.profit_margin))}%`}})})]}),e.jsx("div",{children:e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Net Profit"}),e.jsx("span",{className:`text-sm font-medium ${d.net_profit>0?"text-green-400":"text-red-400"}`,children:g(d.net_profit)})]})}),e.jsx("div",{children:e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Monthly Recurring Revenue"}),e.jsx("span",{className:"text-sm font-medium text-cyan-400",children:g(d.monthly_recurring_revenue)})]})}),e.jsx("div",{children:e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Avg Processing Time"}),e.jsxs("span",{className:"text-sm font-medium text-green-400",children:[r==null?void 0:r.avgProcessingTime,"s"]})]})})]})]})]}),j==="transactions"&&e.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Transaction History"}),e.jsxs("button",{className:"flex items-center space-x-2 px-3 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg transition-colors",children:[e.jsx(X,{className:"h-4 w-4"}),e.jsx("span",{children:"Export"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-700",children:[e.jsx("th",{className:"text-left pb-3 text-sm text-gray-400",children:"Date/Time"}),e.jsx("th",{className:"text-left pb-3 text-sm text-gray-400",children:"Type"}),e.jsx("th",{className:"text-left pb-3 text-sm text-gray-400",children:"Amount"}),e.jsx("th",{className:"text-left pb-3 text-sm text-gray-400",children:"Method"}),e.jsx("th",{className:"text-left pb-3 text-sm text-gray-400",children:"Status"}),e.jsx("th",{className:"text-left pb-3 text-sm text-gray-400",children:"Gateway"})]})}),e.jsx("tbody",{children:l.map(s=>e.jsxs("tr",{className:"border-b border-gray-800",children:[e.jsx("td",{className:"py-3 text-sm",children:new Date(s.processed_at).toLocaleString()}),e.jsx("td",{className:"py-3",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs ${s.type==="revenue"?"bg-green-500/20 text-green-400":s.type==="expense"?"bg-red-500/20 text-red-400":"bg-gray-500/20 text-gray-400"}`,children:s.type})}),e.jsx("td",{className:"py-3 font-medium",children:g(s.amount,s.currency)}),e.jsx("td",{className:"py-3 text-sm text-gray-400",children:s.payment_method}),e.jsx("td",{className:"py-3",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs ${R(s.status)}`,children:s.status})}),e.jsx("td",{className:"py-3 text-sm text-gray-400",children:s.gateway})]},s.id))})]})})]}),j==="fraud"&&e.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center space-x-2",children:[e.jsx(v,{className:"h-5 w-5 text-red-400"}),e.jsx("span",{children:"Fraud Detection Alerts"})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[e.jsx("span",{className:"text-gray-400",children:"Real-time monitoring active"}),e.jsx("div",{className:"h-2 w-2 bg-green-500 rounded-full animate-pulse"})]})]}),e.jsx("div",{className:"space-y-3",children:A.length>0?A.map(s=>e.jsx("div",{className:`p-4 rounded-lg border ${s.risk_score>=70?"bg-red-900/20 border-red-500/30":s.risk_score>=55?"bg-yellow-900/20 border-yellow-500/30":"bg-blue-900/20 border-blue-500/30"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(F,{className:`h-5 w-5 ${N(s.risk_score)}`}),e.jsx("span",{className:"font-medium",children:s.alert_type}),e.jsxs("span",{className:`px-2 py-1 rounded text-xs ${N(s.risk_score)}`,children:["Risk: ",s.risk_score,"%"]})]}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:s.description}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Transaction ID: ",s.transaction_id]})]}),e.jsx("div",{className:"text-xs text-gray-400",children:new Date(s.created_at).toLocaleTimeString()})]})},s.id)):e.jsxs("div",{className:"text-center py-8 text-gray-400",children:[e.jsx(v,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No fraud alerts detected"}),e.jsx("p",{className:"text-sm",children:"All transactions appear legitimate"})]})})]}),e.jsx("div",{className:"bg-gray-800/30 border border-gray-700 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-400",children:[e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Q,{className:"h-4 w-4"}),e.jsx("span",{children:"Global Payments"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(z,{className:"h-4 w-4"}),e.jsx("span",{children:"Real-time Processing"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(B,{className:"h-4 w-4"}),e.jsxs("span",{children:["Last updated: ",new Date(b.last_updated).toLocaleTimeString()]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{children:"Uptime: 99.9%"}),e.jsx("div",{className:"h-2 w-2 bg-green-500 rounded-full"})]})]})})]})};export{ne as default};
//# sourceMappingURL=FinanceModule-C5CE1K80.js.map

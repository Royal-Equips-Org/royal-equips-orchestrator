# üîß Runtime Logs Fix Documentation

## Problem Solved

The Royal Equips Empire workflows were experiencing failures due to missing runtime log files:

```
No files were found with the provided path... No artifacts will be uploaded.
```

Specifically, workflows expected these files to exist:
- `/home/runner/work/_temp/runtime-logs/blocked.jsonl`
- `/home/runner/work/_temp/runtime-logs/blocked.md`

## Solution Implemented

### 1. üìù Runtime Logger Script (`scripts/runtime_logger.py`)

A comprehensive Python script that ensures runtime log files always exist:

```bash
# Basic usage - creates empty logs (no blocked events)
python scripts/runtime_logger.py

# Create logs with blocked events
python scripts/runtime_logger.py \
  --add-event "workflow:Sample blocked event" \
  --add-event "security:Security alert detected" \
  --verbose

# Custom directory
python scripts/runtime_logger.py --dir /custom/path/runtime-logs
```

**Features:**
- ‚úÖ Always creates required log files
- ‚úÖ Structured JSON logging with metadata
- ‚úÖ Human-readable Markdown reports
- ‚úÖ Support for blocked events with different severity levels
- ‚úÖ GitHub Actions environment integration

### 2. üîß Shell Script (`scripts/ensure-runtime-logs.sh`)

Simple shell script for basic log file creation:

```bash
# Basic usage
./scripts/ensure-runtime-logs.sh

# Creates empty blocked.jsonl and blocked.md files
# Uses default path: /home/runner/work/_temp/runtime-logs
```

### 3. üîÑ Reusable Workflow (`.github/workflows/ensure-runtime-logs.yml`)

Reusable workflow that other workflows can call:

```yaml
jobs:
  prepare-logs:
    uses: ./.github/workflows/ensure-runtime-logs.yml
    with:
      runtime_logs_dir: '/home/runner/work/_temp/runtime-logs'
      create_sample_events: false

  main-job:
    needs: prepare-logs
    runs-on: ubuntu-latest
    steps:
      # Your workflow steps here
      - name: Upload runtime logs
        uses: actions/upload-artifact@v4
        with:
          name: runtime-logs
          path: /home/runner/work/_temp/runtime-logs/
          if-no-files-found: warn  # Now safe!
```

### 4. üõ°Ô∏è Artifact Upload Guards

Updated existing workflows with proper error handling:

```yaml
# Before (would fail if files missing)
- name: Upload artifacts
  uses: actions/upload-artifact@v4
  with:
    name: my-artifacts
    path: some-files/

# After (graceful handling)
- name: Upload artifacts
  uses: actions/upload-artifact@v4
  with:
    name: my-artifacts
    path: some-files/
    if-no-files-found: warn  # or 'error' if files are critical
```

## üìä Log File Formats

### blocked.jsonl
```json
{
  "metadata": {
    "generated_at": "2024-01-15T10:30:00+00:00",
    "workflow_run": "12345678",
    "repository": "Royal-Equips-Org/royal-equips-orchestrator",
    "event_count": 2
  },
  "blocked_events": [
    {
      "type": "workflow",
      "message": "Dependency conflict detected",
      "timestamp": "2024-01-15T10:29:45+00:00",
      "severity": "warning"
    }
  ]
}
```

### blocked.md
```markdown
# Runtime Logs - Blocked Events Report

## Summary
**Generated:** 2024-01-15 10:30:00 UTC  
**Workflow Run:** 12345678  
**Repository:** Royal-Equips-Org/royal-equips-orchestrator  
**Total Blocked Events:** 1

## Status
‚ö†Ô∏è **1 Blocked Events Detected**

### Blocked Events Details

#### Event 1
- **Type:** workflow
- **Message:** Dependency conflict detected
- **Timestamp:** 2024-01-15T10:29:45+00:00
- **Severity:** warning

---
*Generated by Royal Equips Empire Runtime Logging System* üöÄ
```

## üöÄ Usage in Workflows

### Method 1: Direct Script Call
```yaml
steps:
  - name: Ensure runtime logs exist
    run: |
      python scripts/runtime_logger.py --verbose
      
  - name: Upload logs (now works!)
    uses: actions/upload-artifact@v4
    with:
      name: runtime-logs
      path: /home/runner/work/_temp/runtime-logs/
      if-no-files-found: error
```

### Method 2: Using Reusable Workflow
```yaml
jobs:
  prepare-logs:
    uses: ./.github/workflows/ensure-runtime-logs.yml
    
  main-workflow:
    needs: prepare-logs
    # ... rest of your workflow
```

### Method 3: Shell Script
```yaml
steps:
  - name: Create runtime logs
    run: ./scripts/ensure-runtime-logs.sh
```

## üß™ Testing the Fix

Run the demonstration workflow to see the fix in action:

```bash
# Via GitHub UI: Actions tab ‚Üí "Runtime Logs Fix Demo" ‚Üí Run workflow
# Or via CLI:
gh workflow run runtime-logs-demo.yml -f demo_type=success
```

Available demo types:
- `success` - Normal operation (no blocked events)
- `with_blocked_events` - Demo with sample blocked events
- `comprehensive_test` - Full test with multiple event types

## üìã Integration Checklist

When adding runtime logs to your workflows:

### For New Workflows:
- [ ] Add runtime log creation step early in the workflow
- [ ] Use `if-no-files-found: warn` for optional artifacts
- [ ] Use `if-no-files-found: error` for critical artifacts
- [ ] Test both success and failure scenarios

### For Existing Workflows:
- [ ] Identify all `upload-artifact` steps
- [ ] Add `if-no-files-found` parameter
- [ ] Add runtime log creation if needed
- [ ] Test the updated workflow

### Best Practices:
- [ ] Always create log directories with `mkdir -p`
- [ ] Use structured logging (JSON) for machine readability
- [ ] Include human-readable reports (Markdown) for manual review
- [ ] Add metadata (timestamps, workflow info, repository)
- [ ] Handle both successful and error scenarios gracefully

## üîç Troubleshooting

### Issue: "No files were found" error still occurs
**Solution:** Ensure the script is called before the artifact upload step:
```yaml
steps:
  - name: Create logs  # Must come first!
    run: python scripts/runtime_logger.py
  - name: Upload artifacts
    uses: actions/upload-artifact@v4
    # ...
```

### Issue: Permission denied on scripts
**Solution:** Make scripts executable:
```yaml
- name: Make scripts executable
  run: |
    chmod +x scripts/ensure-runtime-logs.sh
    chmod +x scripts/runtime_logger.py
```

### Issue: Custom log directory not working
**Solution:** Ensure directory exists and use absolute paths:
```yaml
- name: Create custom logs
  run: |
    mkdir -p /custom/logs/path
    python scripts/runtime_logger.py --dir /custom/logs/path
```

## üéØ Results

‚úÖ **Problem Solved:** No more workflow failures due to missing runtime logs  
‚úÖ **Self-Healing:** Workflows automatically create required log files  
‚úÖ **Comprehensive:** Both JSON and Markdown formats supported  
‚úÖ **Flexible:** Configurable directories and event types  
‚úÖ **Robust:** Proper error handling and file existence checks  

The Royal Equips Empire CI/CD infrastructure is now bulletproof against runtime log failures! üöÄüëë